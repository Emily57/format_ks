# SPECIFICATION.txt

ティラノスクリプト ks ファイル自動整形ツール仕様書

script: SPECIFICATION.txtの仕様に従って、JSファイルを修正してください

## 概要

このWebアプリケーションは、ユーザーが入力したティラノスクリプトの .ks テキストを整形し、可読性を向上させるツールです。

## 処理の流れ

入力されたテキストに対して、以下の順に処理を行い、結果を表示します。表示されたテキストはコピーボタンでコピー可能です。

### 前提

[] で囲まれたものを "タグ" と呼びます。

「*」または「 ; *」で始まる行を "ラベル" と呼びます。（例: *test , ; *test）

### 処理規則（上から順）

空行（何もない行）はすべて削除

行頭・行末の空白を削除

例:
  test 
↓
test

タグ [r], [p], [s], [iscript], [endscript] が行末でない場合、直後に改行を追加し、行末にする

タグ [p] の次の行に空行を1行追加する。ただし、次の行が ; end の場合は追加しない

; end の次の行に空行を1行追加する。ただし、次の行が ; end の場合は追加しない

[iscript], [endscript] が行頭でない場合、直前に改行を追加し、行頭にする

ラベル行から ; end の行までを1つのブロックとし、ブロックごとに半角スペース2つのインデントを追加する
ネストしたブロックがある場合、インデントは 2つ → 4つ → 6つ... と増加。ただし、その行が空行なら、空白は追加しなくていい。

例：
*test1
  1つ目のブロック
  *test2
    ブロックの中のブロック
    *test3
      ブロックの中のブロックの中のブロック
    ; end
  ; end
  1つ目のブロック内
; end

[iscript] から [endscript] までを1つのブロックとし、ブロックごとに半角スペース2つのインデントを追加する

タグ内の次のような要素を「引数」と呼びます。
- 「='」で始まり、「'」で終わる文字や数字
- 「="」で始まり、「"」で終わる文字や数字
- 「='」や「="」では始まらないが、「=」で始まり、半角スペースまたは「]」で終わる文字や数字
例: [bg storage=background/test.jpg time=2000 cond="aaa === bbb"]
この場合、background/test.jpg と、2000と、"aaa === bbb"が引数
すべての引数はテキストとして扱われるため、"（ダブルクォーテーション）で囲む必要がある。
例: [bg storage="background/test.jpg" time="2000" cond="aaa === bbb"]
" で囲われていない引数は、" で囲むように修正する。すでに囲われているならそのままにする。
なお、''で囲われているのだとしたら、それは不適切なので、"で囲み直す。
不適切な例: [bg storage='background/test.jpg' time='2000' cond='aaa === bbb']
修正した例: [bg storage="background/test.jpg" time="2000" cond="aaa === bbb"]
